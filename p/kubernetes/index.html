<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Kubernetes, also known as K8s, is an open-source system for automating deployment, scaling, and management of containerized applications."><title>Kubernetes</title><link rel=canonical href=https://ilolicon.github.io/p/kubernetes/><link rel=stylesheet href=/scss/style.min.abbd69b2908fdfcd5179898beaafd374514a86538d81639ddd2c58c06ae54e40.css><meta property="og:title" content="Kubernetes"><meta property="og:description" content="Kubernetes, also known as K8s, is an open-source system for automating deployment, scaling, and management of containerized applications."><meta property="og:url" content="https://ilolicon.github.io/p/kubernetes/"><meta property="og:site_name" content="ilolicon's Blog"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Cloud Native"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="Pod"><meta property="article:tag" content="Service"><meta property="article:tag" content="Kubeadm"><meta property="article:published_time" content="2020-12-20T14:21:14+08:00"><meta property="article:modified_time" content="2020-12-20T14:21:14+08:00"><meta name=twitter:title content="Kubernetes"><meta name=twitter:description content="Kubernetes, also known as K8s, is an open-source system for automating deployment, scaling, and management of containerized applications."><link rel="shortcut icon" href=/img/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu96a5ab8e0364e843af4687201b687892_162934_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>ğŸ¥</span></figure><div class=site-meta><h1 class=site-name><a href=/>ilolicon's Blog</a></h1><h2 class=site-description>Keep Calm and Carry On.</h2></div></header><ol class=social-menu><li><a href=https://github.com/ilolicon target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://twitter.com target=_blank title=Twitter rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li><a href=/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>Links</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>æš—è‰²æ¨¡å¼</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#å®¹å™¨ç¼–æ’>å®¹å™¨ç¼–æ’</a></li><li><a href=#kubernetesæ¶æ„æ¦‚è¿°>Kubernetesæ¶æ„æ¦‚è¿°</a></li><li><a href=#pod>Pod</a></li><li><a href=#service>Service</a></li><li><a href=#ç½‘ç»œé€šä¿¡>ç½‘ç»œé€šä¿¡</a></li><li><a href=#namespace>Namespace</a></li><li><a href=#åˆå§‹åŒ–kubernetesé›†ç¾¤>åˆå§‹åŒ–Kubernetesé›†ç¾¤</a></li><li><a href=#kuberntesèµ„æºæ¦‚è¿°>Kuberntesèµ„æºæ¦‚è¿°</a><ol><li><a href=#èµ„æºæ¸…å•å®šä¹‰>èµ„æºæ¸…å•å®šä¹‰</a></li><li><a href=#podæ¦‚è¿°>Podæ¦‚è¿°</a><ol><li><a href=#è‡ªä¸»å¼pod>è‡ªä¸»å¼Pod</a></li><li><a href=#podèµ„æº>Podèµ„æº</a></li><li><a href=#podç”Ÿå‘½å‘¨æœŸ>Podç”Ÿå‘½å‘¨æœŸ</a></li><li><a href=#podå®¹å™¨æ¢é’ˆç±»å‹>Podå®¹å™¨æ¢é’ˆç±»å‹</a></li><li><a href=#podæ§åˆ¶å™¨>Podæ§åˆ¶å™¨</a></li></ol></li><li><a href=#serviceæ¦‚è¿°>Serviceæ¦‚è¿°</a><ol><li><a href=#serviceä»£ç†>Serviceä»£ç†</a></li><li><a href=#serviceç±»å‹>Serviceç±»å‹</a></li><li><a href=#headless-servicesæ— å¤´service>Headless Services(æ— å¤´Service)</a></li></ol></li><li><a href=#ingress>Ingress</a></li><li><a href=#å­˜å‚¨å·>å­˜å‚¨å·</a><ol><li><a href=#pvpvc>PV/PVC</a></li><li><a href=#storageclass>StorageClass</a></li><li><a href=#configmap>ConfigMap</a></li><li><a href=#secret>Secret</a></li></ol></li></ol></li><li><a href=#statefulsetæ§åˆ¶å™¨>StatefulSetæ§åˆ¶å™¨</a></li><li><a href=#è®¤è¯åŠserviceaccount>è®¤è¯åŠServiceAccount</a><ol><li><a href=#è®¤è¯æˆæƒ>è®¤è¯æˆæƒ</a></li><li><a href=#serviceaccount>ServiceAccount</a></li><li><a href=#rbacæˆæƒ>RBACæˆæƒ</a></li></ol></li><li><a href=#helm>Helm</a></li><li><a href=#reference>Reference</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/cloudnative/ style=background-color:#2a9d8f;color:#fff>CloudNative</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/kubernetes/>Kubernetes</a></h2><h3 class=article-subtitle>Kubernetes, also known as K8s, is an open-source system for automating deployment, scaling, and management of containerized applications.</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Dec 20, 2020</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>é˜…è¯»æ—¶é•¿: 5 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><p><a class=link href=https://kubernetes.io/zh/docs/home/ target=_blank rel=noopener><img src=https://img.shields.io/badge/Kubernetes-README-356DE3 loading=lazy alt="kubernetes readme"></a></p><p><a class=link href=https://kubernetes.io/ target=_blank rel=noopener><img src=/p/kubernetes/icons/kubernetes.svg loading=lazy alt=kubernetes></a></p><p><code>container evolution</code></p><p><img src=/p/kubernetes/icons/container_evolution.svg loading=lazy alt=container_evolution></p><h2 id=å®¹å™¨ç¼–æ’>å®¹å™¨ç¼–æ’</h2><ul><li>Ansible/Saltstack <strong>ä¼ ç»Ÿåº”ç”¨</strong>ç¼–æ’å·¥å…·</li><li>Docker<ul><li>docker compose(dockerå•æœºç¼–æ’)</li><li>docker swarm(dockerä¸»æœºåŠ å…¥docker swarmèµ„æºæ± )</li><li>docker machine(å®Œæˆdockerä¸»æœºåŠ å…¥docker swarmèµ„æºæ± çš„å…ˆå†³æ¡ä»¶/é¢„å¤„ç†å·¥å…·)</li></ul></li><li>Mesos(IDC OS) + marathon(é¢å‘å®¹å™¨ç¼–æ’çš„æ¡†æ¶)</li><li>kubernetes(Borg)<ul><li>è‡ªåŠ¨è£…ç®±(åŸºäºä¾èµ– è‡ªåŠ¨å®Œæˆå®¹å™¨éƒ¨ç½² ä¸å½±å“å…¶å¯ç”¨æ€§)</li><li>è‡ªæˆ‘ä¿®å¤</li><li>æ°´å¹³æ‰©å±•</li><li>æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡</li><li>è‡ªåŠ¨å‘å¸ƒå’Œå›æ»š</li><li>å¯†é’¥å’Œé…ç½®ç®¡ç†</li><li>å­˜å‚¨ç¼–æ’</li><li>ä»»åŠ¡æ‰¹é‡å¤„ç†è¿è¡Œ</li></ul></li></ul><p>æ¦‚å¿µ: <code>DevOps</code> <code>MicroServices</code> <code>Blockchain</code></p><ul><li>CI: æŒç»­é›†æˆ</li><li>CD: æŒç»­äº¤äº’ Delivery</li><li>CD: æŒç»­éƒ¨ç½² Deployment</li></ul><h2 id=kubernetesæ¶æ„æ¦‚è¿°>Kubernetesæ¶æ„æ¦‚è¿°</h2><p><img src=/p/kubernetes/icons/kubernetes_cluster.png width=576 height=335 srcset="/p/kubernetes/icons/kubernetes_cluster_hu5d0dab3c0d7d17e817e2f0f85b092344_117781_480x0_resize_box_3.png 480w, /p/kubernetes/icons/kubernetes_cluster_hu5d0dab3c0d7d17e817e2f0f85b092344_117781_1024x0_resize_box_3.png 1024w" loading=lazy alt=kubernetes-cluster class=gallery-image data-flex-grow=171 data-flex-basis=412px></p><ul><li>æœ‰ä¸­å¿ƒèŠ‚ç‚¹çš„é›†ç¾¤æ¶æ„ç³»ç»Ÿ(æŠ½è±¡å„ä¸»æœºèµ„æº ç»Ÿä¸€å¯¹å¤–æä¾›è®¡ç®—)</li><li>Master/Node(Worker)<ul><li>Master<ul><li>etcd: å…¼å…·ä¸€è‡´æ€§å’Œé«˜å¯ç”¨æ€§çš„é”®å€¼æ•°æ®åº“ å¯ä»¥ä½œä¸ºä¿å­˜Kubernetesæ‰€æœ‰é›†ç¾¤æ•°æ®çš„åå°æ•°æ®åº“</li><li>API Server(å…¬å¼€kubernetes API)</li><li>Scheduler(è°ƒåº¦å™¨)</li><li>Controller-Manager(æ§åˆ¶å™¨)<ul><li>èŠ‚ç‚¹æ§åˆ¶å™¨(Node Controller): è´Ÿè´£åœ¨èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶è¿›è¡Œé€šçŸ¥å’Œå“åº”</li><li>ä»»åŠ¡æ§åˆ¶å™¨(Job controller): ç›‘æµ‹ä»£è¡¨ä¸€æ¬¡æ€§ä»»åŠ¡çš„Jobå¯¹è±¡ ç„¶ååˆ›å»ºPodsæ¥è¿è¡Œè¿™äº›ä»»åŠ¡ç›´è‡³å®Œæˆ</li><li>ç«¯ç‚¹æ§åˆ¶å™¨(Endpoints Controller): å¡«å……ç«¯ç‚¹(Endpoints)å¯¹è±¡(å³åŠ å…¥Serviceä¸Pod)</li><li>æœåŠ¡å¸æˆ·å’Œä»¤ç‰Œæ§åˆ¶å™¨(Service Account & Token Controllers): ä¸ºæ–°çš„å‘½åç©ºé—´åˆ›å»ºé»˜è®¤å¸æˆ·å’ŒAPIè®¿é—®ä»¤ç‰Œ</li></ul></li></ul></li><li>Node<ul><li>kubelet: é›†ç¾¤ä»£ç† å¹¶ä¸è¿è¡Œå®¹å™¨</li><li>kube-proxy: ç½‘ç»œä»£ç† ç®¡ç†Serviceçš„åˆ›å»º æ›´æ–°(iptables/ipvs)</li><li>å®¹å™¨è¿è¡Œæ—¶(å®¹å™¨å¼•æ“): è¿è¡Œå®¹å™¨ æ”¯æŒ<a class=link href=https://kubernetes.io/zh/docs/reference/kubectl/docker-cli-to-kubectl/ target=_blank rel=noopener>Docker</a>/<a class=link href=https://containerd.io/docs/ target=_blank rel=noopener>containerd</a>/<a class=link href=https://cri-o.io/#what-is-cri-o target=_blank rel=noopener>CRI-O</a>ä»¥åŠä»»ä½•å®ç° <a class=link href=https://github.com/kubernetes/community/blob/master/contributors/devel/sig-node/container-runtime-interface.md target=_blank rel=noopener>Kubernetes CRI (å®¹å™¨è¿è¡Œç¯å¢ƒæ¥å£)</a></li></ul></li></ul></li></ul><p><a class=link href=https://kubernetes.io/zh/docs/concepts/overview/components/ target=_blank rel=noopener>kubernetesç»„ä»¶</a></p><p><img src=/p/kubernetes/icons/kubernetes_cluster02.png width=821 height=568 srcset="/p/kubernetes/icons/kubernetes_cluster02_hu5ddc702c3d24b1f991acd583b33b036e_257528_480x0_resize_box_3.png 480w, /p/kubernetes/icons/kubernetes_cluster02_hu5ddc702c3d24b1f991acd583b33b036e_257528_1024x0_resize_box_3.png 1024w" loading=lazy alt=kuberbetes-cluster02 class=gallery-image data-flex-grow=144 data-flex-basis=346px></p><p><img src=/p/kubernetes/icons/components-of-kubernetes.svg loading=lazy alt=components-of-kubernetes></p><h2 id=pod>Pod</h2><ul><li>Pod<ul><li>è‡ªä¸»å¼Pod</li><li>æ§åˆ¶å™¨ç®¡ç†çš„Pod(å»ºè®®ä½¿ç”¨)<ul><li>ReplicationController(å‰¯æœ¬æ§åˆ¶å™¨)</li><li>ReplicaSet(å‰¯æœ¬é›†æ§åˆ¶å™¨ ä¸ç›´æ¥ä½¿ç”¨ æœ‰ä¸€ä¸ªå£°æ˜å¼æ›´æ–°çš„æ§åˆ¶å™¨Deployment)</li><li>Deployment(ç®¡ç†æ— çŠ¶æ€åº”ç”¨)<ul><li>HPA(HorizontalPodAutoscaler) æ°´å¹³Podè‡ªåŠ¨ä¼¸ç¼©æ§åˆ¶å™¨</li></ul></li><li>StatefulSet(æœ‰çŠ¶æ€å‰¯æœ¬é›†)</li><li>DaemonSet</li><li>Job/CronJob</li></ul></li><li>Label<ul><li>Label Selector</li><li>Label: key=value</li></ul></li></ul></li></ul><h2 id=service>Service</h2><ul><li>iptablesçš„DNATè§„åˆ™(è°ƒåº¦å¤šä¸ªserviceåç«¯ ipvsè§„åˆ™)</li><li>é æ ‡ç­¾é€‰æ‹©å™¨ å…³è”Podå¯¹è±¡</li><li>service åç§° å¯ä»¥è¢«è§£æ(DNS Podå®ç°è§£æ - åŸºç¡€æ¶æ„çº§çš„Pod)<ul><li>åŸºç¡€æ¶æ„çº§Pod <code>AddOns</code>é›†ç¾¤é™„åŠ ç»„ä»¶ æ”¯æ’‘å…¶ä»–æœåŠ¡éœ€è¦ä½¿ç”¨åˆ°çš„æœåŠ¡</li><li>åŠ¨æ€æ›´æ–°DNSè§£æ</li></ul></li></ul><h2 id=ç½‘ç»œé€šä¿¡>ç½‘ç»œé€šä¿¡</h2><ul><li>åŒä¸€ä¸ªPodå†…çš„å¤šä¸ªå®¹å™¨é—´: lo</li><li>å„Podä¹‹é—´çš„é€šä¿¡(ä¸ç›´æ¥é€šä¿¡ é€šè¿‡Serviceé€šä¿¡)<ul><li>äºŒå±‚å¹¿æ’­ -> å¹¿æ’­é£æš´</li><li>Overlay Network å åŠ ç½‘ç»œ<ul><li>éœ€è¦ç¡®ä¿æ¯ä¸€ä¸ªPodç½‘ç»œåœ°å€ä¸ä¼šå†²çª</li></ul></li></ul></li><li>Podå’ŒServiceä¹‹é—´çš„é€šä¿¡</li></ul><p>ä¾èµ–ç¬¬ä¸‰æ–¹æ’ä»¶(é™„ä»¶) é€šè¿‡CNI(å®¹å™¨ç½‘ç»œæ¥å£)æ¥å…¥</p><ul><li>flannel: ç½‘ç»œé…ç½® Podç½‘ç»œ-10.244.0.0/16</li><li>calico: ç½‘ç»œé…ç½® ç½‘ç»œç­–ç•¥(Podä¹‹é—´ã€Namespace&mldr;ä¹‹é—´çš„è®¿é—®æˆ–éš”ç¦»)</li><li>canel: ä¸Šé¢ä¸¤ç§æ­é…ä½¿ç”¨</li><li>&mldr;</li></ul><p><img src=/p/kubernetes/icons/k8s-network.png width=2156 height=1074 srcset="/p/kubernetes/icons/k8s-network_hu450a176e8d46831d14cdc75349a18d18_2340849_480x0_resize_box_3.png 480w, /p/kubernetes/icons/k8s-network_hu450a176e8d46831d14cdc75349a18d18_2340849_1024x0_resize_box_3.png 1024w" loading=lazy alt=k8s-network class=gallery-image data-flex-grow=200 data-flex-basis=481px></p><h2 id=namespace>Namespace</h2><ul><li>ç®¡ç†çš„è¾¹ç•Œ</li><li>éš”ç¦»ä¸åŒåç§°ç©ºé—´çš„ç½‘ç»œ</li></ul><h2 id=åˆå§‹åŒ–kubernetesé›†ç¾¤>åˆå§‹åŒ–Kubernetesé›†ç¾¤</h2><p><img src=/p/kubernetes/icons/structure.png width=600 height=498 srcset="/p/kubernetes/icons/structure_hu12b93151174b3e04ef92f8cdd319b528_196054_480x0_resize_box_3.png 480w, /p/kubernetes/icons/structure_hu12b93151174b3e04ef92f8cdd319b528_196054_1024x0_resize_box_3.png 1024w" loading=lazy alt=structure class=gallery-image data-flex-grow=120 data-flex-basis=289px></p><p><img src=/p/kubernetes/icons/k8s-network-structure02.png width=2418 height=1128 srcset="/p/kubernetes/icons/k8s-network-structure02_hu86518e8c49d554475a7b0c3fae4a2e9e_2485545_480x0_resize_box_3.png 480w, /p/kubernetes/icons/k8s-network-structure02_hu86518e8c49d554475a7b0c3fae4a2e9e_2485545_1024x0_resize_box_3.png 1024w" loading=lazy alt=structure02 class=gallery-image data-flex-grow=214 data-flex-basis=514px></p><ul><li><p><a class=link href=https://github.com/kubernetes/kubeadm target=_blank rel=noopener>kubeadm</a></p><ul><li><p>master/nodes: å®‰è£…<code>kubetlet</code> <code>kubeadm</code> <code>docker</code></p></li><li><p>master: <code>kubeadm init</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># master init</span>
</span></span><span class=line><span class=cl>sudo kubeadm init <span class=se>\ </span>
</span></span><span class=line><span class=cl>  --kubernetes-version<span class=o>=</span>v1.20.15 <span class=se>\ </span>    <span class=c1># k8sç‰ˆæœ¬</span>
</span></span><span class=line><span class=cl>  --pod-network-cidr<span class=o>=</span>10.244.0.0/16 <span class=se>\ </span> <span class=c1># podç½‘æ®µ</span>
</span></span><span class=line><span class=cl>  --service-cidr<span class=o>=</span>10.96.0.0/12 <span class=se>\ </span>      <span class=c1># serviceç½‘æ®µ</span>
</span></span><span class=line><span class=cl>  --ignore-preflight-errors<span class=o>=</span>Swap      <span class=c1># å¿½ç•¥é¢„æ£€é”™è¯¯</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>nodes: <code>kubeadm join</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># nodes join</span>
</span></span><span class=line><span class=cl>sudo kubeadm join <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  10.211.55.57:6443 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --token hewmhd.fro3dttm001dohys <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --discovery-token-ca-cert-hash sha256:826faddde57dc07d0fbf31e7aa809eb5fc22613787a2fc8ab50f55c4e706cd45
</span></span></code></pre></td></tr></table></div></div></li><li><p>Images</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ilolicon@master:~$ sudo docker image ls
</span></span><span class=line><span class=cl>REPOSITORY                           TAG        IMAGE ID       CREATED         SIZE
</span></span><span class=line><span class=cl>k8s.gcr.io/kube-apiserver            v1.20.15   3ecdeee1255c   <span class=m>7</span> months ago    113MB
</span></span><span class=line><span class=cl>k8s.gcr.io/kube-controller-manager   v1.20.15   403106abce42   <span class=m>7</span> months ago    108MB
</span></span><span class=line><span class=cl>k8s.gcr.io/kube-scheduler            v1.20.15   bfc1b1725466   <span class=m>7</span> months ago    44.1MB
</span></span><span class=line><span class=cl>k8s.gcr.io/kube-proxy                v1.20.15   3c1b1abd329d   <span class=m>7</span> months ago    93.6MB
</span></span><span class=line><span class=cl>k8s.gcr.io/etcd                      3.4.13-0   05b738aa1bc6   <span class=m>24</span> months ago   312MB
</span></span><span class=line><span class=cl>k8s.gcr.io/coredns                   1.7.0      db91994f4ee8   <span class=m>2</span> years ago     42.8MB
</span></span><span class=line><span class=cl>k8s.gcr.io/pause                     3.2        2a060e2e7101   <span class=m>2</span> years ago     484kB  <span class=c1># åˆ›å»ºåŸºç¡€æ¶æ„å®¹å™¨ä½¿ç”¨ ä¸ºPodæä¾›åº•å±‚åŸºç¡€ç»“æ„ æ— éœ€å¯åŠ¨å’Œè¿è¡Œ</span>
</span></span></code></pre></td></tr></table></div></div></li></ul></li></ul><h2 id=kuberntesèµ„æºæ¦‚è¿°>Kuberntesèµ„æºæ¦‚è¿°</h2><ul><li>RESTfulé£æ ¼API<ul><li>GETã€POSTã€DELETEã€PUT&mldr;</li><li>kubectl runã€getã€exposeã€edit&mldr;</li></ul></li><li>èµ„æº(å¯¹è±¡)<ul><li>workload: Podã€ReplicaSetã€Deploymentã€StatefulSetã€DaemonSetã€Jobã€Cronjob&mldr;</li><li>æœåŠ¡å‘ç°ä¸å‡è¡¡: Serviceã€Ingress&mldr;</li><li>é…ç½®ä¸å­˜å‚¨: Volumeã€CSI&mldr;<ul><li>ConfigMapã€Secret</li><li>DownwardAPI</li></ul></li><li>é›†ç¾¤çº§èµ„æº<ul><li>Namespaceã€Nodeã€Roleã€ClusterRoleã€RoleBindingã€ClusterRoleBinding</li></ul></li><li>å…ƒæ•°æ®å‹èµ„æº<ul><li>HPAã€PodTemplateã€LimitRange</li></ul></li></ul></li></ul><h3 id=èµ„æºæ¸…å•å®šä¹‰>èµ„æºæ¸…å•å®šä¹‰</h3><ul><li><p>åˆ›å»ºèµ„æºçš„æ–¹æ³•</p><ul><li><p>apiserverä»…æ¥æ”¶jsonæ ¼å¼çš„èµ„æºå®šä¹‰</p></li><li><p>yamlæ ¼å¼æä¾›é…ç½®æ¸…å• apiserverå¯è‡ªåŠ¨å°†å…¶è½¬æ¢ä¸ºjsonæ ¼å¼ è€Œåå†æäº¤</p></li></ul></li><li><p>å¤§éƒ¨åˆ†èµ„æºçš„é…ç½®æ¸…å• ä¸»è¦éƒ½æœ‰äº”ä¸ªä¸»è¦çš„éƒ¨åˆ†ç»„æˆ</p><ul><li><p>apiversion</p><ul><li><code>kubectl api-versions</code> # æ‰€å±APIç¾¤ç»„</li><li>æ ‡è¯†æ–¹å¼: <code>group/version</code> çœç•¥ç»„ååˆ™ä¸ºcore group</li></ul></li><li><p>kind: èµ„æºç±»åˆ«</p></li><li><p>metadata: å…ƒæ•°æ®</p><ul><li>name: åŒä¸€ç±»åˆ«ä¸­ nameéœ€è¦å”¯ä¸€</li><li>namespace: æ‰€å±k8sçš„å“ªä¸ªåç§°ç©ºé—´</li><li>labels</li><li>annotations</li><li>æ¯ä¸ªèµ„æºçš„å¼•ç”¨PATH<ul><li><code>/api/${GROUP/VERSION}/namespace/${NAMESPACE}/${TYPE}/${NAME}</code></li></ul></li></ul></li><li><p>spec(é‡è¦): å®šä¹‰ç”¨æˆ·æœŸæœ›çš„çŠ¶æ€ disired state</p></li><li><p>status: å½“å‰çŠ¶æ€ current state æœ¬å­—æ®µç”±Kubernetesé›†ç¾¤ç»´æŠ¤</p></li></ul></li><li><p>å­—æ®µå¤ªå¤š å¯ä»¥å€ŸåŠ©<code>kubectl explain --help</code>å‘½ä»¤æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</p><ul><li>kubectl explain pod</li><li>kubectl explain pod.metadata</li></ul></li></ul><h3 id=podæ¦‚è¿°>Podæ¦‚è¿°</h3><p><a class=link href=https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/ target=_blank rel=noopener>pods</a></p><h4 id=è‡ªä¸»å¼pod>è‡ªä¸»å¼Pod</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>pod-demo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>tier</span><span class=p>:</span><span class=w> </span><span class=l>frontend</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>busybox:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>command</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=s2>&#34;/bin/sh&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=s2>&#34;-c&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=s2>&#34;sleep 3600&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=podèµ„æº>Podèµ„æº</h4><ul><li><p>spec.containers &lt;[]object></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># kubectl explain pod.spec.containers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>&lt;string&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>&lt;string&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>&lt;string&gt; </span><span class=w> </span><span class=c># Always Never IfNotPresent</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># ä¿®æ”¹é•œåƒä¸­çš„é»˜è®¤åº”ç”¨</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>command/args</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>https://kubernetes.io/docs/tasks/inject-data-application/define-command-argument-container/</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>æ ‡ç­¾</p><ul><li>key = value<ul><li>key: å­—æ¯ æ•°å­— _ - .</li><li>value: å¯ä»¥ä¸ºç©º åªèƒ½å­—æ¯æˆ–æ•°å­—å¼€å¤´åŠç»“å°¾</li></ul></li></ul></li><li><p>æ ‡ç­¾é€‰æ‹©å™¨</p><ul><li>ç­‰å€¼å…³ç³»: =ã€==ã€!=(ä¸ç­‰äºä¼šç­›é€‰å‡ºä¸å…·æœ‰è¯¥æ ‡ç­¾çš„èµ„æº)</li><li>é›†åˆå…³ç³»<ul><li>KEY in (VALUE1,VALUE2,&mldr;)</li><li>KEY notin (VALUE1,VALUE2,&mldr;)</li><li>KEY # å­˜åœ¨è¿™ä¸ªKEYå°±è¡Œ</li><li>!KEY # ä¸å­˜åœ¨æ­¤é”®çš„èµ„æº</li></ul></li></ul></li><li><p>è®¸å¤šèµ„æºæ”¯æŒå†…åµŒå­—æ®µæ¥ä½¿ç”¨æ ‡ç­¾é€‰æ‹©å™¨</p><ul><li>matchLabels: ç›´æ¥ç»™å®šé”®å€¼</li><li>matchExpressions: åŸºäºç»™å®šçš„è¡¨è¾¾å¼æ¥å®šä¹‰ä½¿ç”¨æ ‡ç­¾é€‰æ‹©å™¨<ul><li>{key: &ldquo;KEY&rdquo;, operator: &ldquo;OPERATOR&rdquo;,values:[VAL1,VAL2,VAL3,&mldr;]</li><li>æ“ä½œç¬¦<ul><li>Inã€NotIn: valueså­—æ®µçš„å€¼å¿…é¡»ä¸ºéç©ºåˆ—è¡¨</li><li>Existsã€NotExists: valueså­—æ®µçš„å€¼å¿…é¡»ä¸ºç©ºåˆ—è¡¨</li></ul></li></ul></li></ul></li><li><p>spec.nodeSelector &lt;map[striong]string></p><ul><li>èŠ‚ç‚¹æ ‡ç­¾é€‰æ‹©å™¨</li></ul></li><li><p>spec.nodeName <code>&lt;string></code> # ç›´æ¥æŒ‡å®šè¿è¡Œnode</p></li><li><p>annotations</p><ul><li>ä¸labelä¸åŒçš„åœ°æ–¹åœ¨äº å®ƒä¸èƒ½ç”¨äºæŒ‘é€‰èµ„æºå¯¹è±¡ ä»…ç”¨äºä¸ºå¯¹è±¡æä¾›<strong>å…ƒæ•°æ®</strong></li><li>æ²¡æœ‰é”®é•¿åº¦/å€¼é•¿åº¦é™åˆ¶</li></ul></li><li><p>spec.restartPolicy</p><ul><li>é‡å¯ç­–ç•¥: One of Always, OnFailure, Never. Default to Always</li></ul></li></ul><h4 id=podç”Ÿå‘½å‘¨æœŸ>Podç”Ÿå‘½å‘¨æœŸ</h4><ul><li><p>çŠ¶æ€</p><ul><li>Pending # è°ƒåº¦å°šæœªå®Œæˆ</li><li>Running # è¿è¡ŒçŠ¶æ€</li><li>Failed</li><li>Succeeded</li><li>Unknown</li><li>&mldr;</li></ul></li><li><p>Podç”Ÿå‘½å‘¨æœŸä¸­çš„é‡è¦è¡Œä¸º</p><ul><li>åˆå§‹åŒ–å®¹å™¨</li><li>å®¹å™¨æ¢æµ‹(è‡ªå®šä¹‰å‘½ä»¤/TCPå¥—æ¥å­—å‘è¯·æ±‚/HTTPåº”ç”¨å±‚è¯·æ±‚)<ul><li>liveness probe: æ¢æµ‹å®¹å™¨æ˜¯å¦å­˜æ´»</li><li>readiness probe: æ¢æµ‹å®¹å™¨æ˜¯å¦å‡†å¤‡å°±ç»ª èƒ½å¯¹å¤–æä¾›æœåŠ¡</li></ul></li><li>é’©å­<ul><li>post start</li><li>pre stop</li></ul></li></ul><p><img src=/p/kubernetes/icons/pod-lifecycle.png width=1802 height=918 srcset="/p/kubernetes/icons/pod-lifecycle_hu63a9e9cf93a88172974cf2b0b759da82_82884_480x0_resize_box_3.png 480w, /p/kubernetes/icons/pod-lifecycle_hu63a9e9cf93a88172974cf2b0b759da82_82884_1024x0_resize_box_3.png 1024w" loading=lazy alt=pod-lifecycle class=gallery-image data-flex-grow=196 data-flex-basis=471px></p></li></ul><h4 id=podå®¹å™¨æ¢é’ˆç±»å‹>Podå®¹å™¨æ¢é’ˆç±»å‹</h4><p><code>kubectl explain pod.spec.containers.livenessProbe</code></p><p><code>kubectl explain pod.spec.containers.readinessProbe</code></p><ul><li>exec Action</li><li>httpGet Action</li><li>tcpSocket Action</li></ul><h4 id=podæ§åˆ¶å™¨>Podæ§åˆ¶å™¨</h4><ul><li><p>ReplicaSet</p><ul><li>Kubectl explain replicaset</li><li>ç”¨æˆ·æœŸæœ›å‰¯æœ¬æ•° æ ‡ç­¾é€‰æ‹©å™¨ Podèµ„æºæ¨¡ç‰ˆ</li><li>ä¸å»ºè®®ç›´æ¥ä½¿ç”¨ReplicaSet</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ReplicaSet</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>release</span><span class=p>:</span><span class=w> </span><span class=l>canary</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp-pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>release</span><span class=p>:</span><span class=w> </span><span class=l>canary</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>environment</span><span class=p>:</span><span class=w> </span><span class=l>qa</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp-container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>Deployment</p><ul><li>æ„å»ºåœ¨ReplicaSetä¹‹ä¸Š è€ŒéPod<ul><li>å®ç°æ»šåŠ¨æ›´æ–°(å¤šå‡ºæˆ–å°‘äºNä¸ªå‰¯æœ¬ æ§åˆ¶æ›´æ–°ç²’åº¦)ã€å›æ»š</li><li>é€šå¸¸ç®¡ç†10ä¸ªå†å²ç‰ˆæœ¬(ReplicaSet)</li></ul></li><li>ç®¡ç†æ— çŠ¶æ€åº”ç”¨æœ€å¥½çš„æ§åˆ¶å™¨</li><li>æ— çŠ¶æ€(åªå…³æ³¨ç¾¤ä½“ã€ä¸å…³æ³¨ä¸ªä½“)ã€æŒç»­è¿è¡Œåº”ç”¨</li><li>å£°æ˜å¼ç®¡ç†(å³å¯ä»¥åˆ›å»º ä¹Ÿå¯ä»¥æ›´æ–° <code>kubectl apply -f deployment.yaml</code>)</li><li><code>kubectl rollout history</code> æŸ¥çœ‹æ»šåŠ¨å†å²</li></ul></li></ul><p><img src=/p/kubernetes/icons/deployment-update.png width=1728 height=566 srcset="/p/kubernetes/icons/deployment-update_hu1b11393a4a96395d8bc44f2effe78eee_1490645_480x0_resize_box_3.png 480w, /p/kubernetes/icons/deployment-update_hu1b11393a4a96395d8bc44f2effe78eee_1490645_1024x0_resize_box_3.png 1024w" loading=lazy alt=deployment-update class=gallery-image data-flex-grow=305 data-flex-basis=732px></p><ul><li><p>DaemonSet</p><ul><li><p><code>kubectl explain deployment.spec.strategy.rollingUpdate</code> # æ»šåŠ¨æ›´æ–°ç­–ç•¥</p></li><li><p>ç¡®ä¿é›†ç¾¤ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹(æˆ–éƒ¨åˆ†æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹)ç²¾ç¡®è¿è¡Œä¸€ä¸ªPodå‰¯æœ¬</p></li><li><p>é€šå¸¸ç”¨äºä¸€äº›ç³»ç»Ÿçº§çš„åå°ä»»åŠ¡</p></li><li><p>æ— çŠ¶æ€ã€æŒç»­è¿è¡Œåº”ç”¨</p></li></ul></li><li><p>Job</p><ul><li>åªåšä¸€æ¬¡ åªè¦å®Œæˆå°±æ­£å¸¸é€€å‡º æ²¡å®Œæˆæ‰è¿›è¡Œé‡æ„</li><li>æ‰§è¡Œä¸€æ¬¡æ€§çš„ä½œä¸š</li><li>ä¸éœ€è¦æŒç»­åœ¨åå°è¿è¡Œ æ‰§è¡Œå®Œæˆå°±é€€å‡º</li></ul></li><li><p>Cronjob</p><ul><li>å‘¨æœŸæ€§Job</li></ul></li><li><p>StatefulSet</p><ul><li>ç®¡ç†æœ‰çŠ¶æ€åº”ç”¨</li><li>æ¯ä¸€ä¸ªpodå‰¯æœ¬å•ç‹¬ç®¡ç† æ‹¥æœ‰è‡ªå·±ç‹¬æœ‰çš„æ ‡è¯†å’Œç‹¬æœ‰çš„æ•°æ®é›†</li></ul></li><li><p>TPR: Third Party Resources 1.2+ - 1.7</p></li><li><p>CDE: Custom Defined Resources 1.8+</p></li><li><p>Operator</p></li></ul><h3 id=serviceæ¦‚è¿°>Serviceæ¦‚è¿°</h3><h4 id=serviceä»£ç†>Serviceä»£ç†</h4><p><a class=link href=https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/ target=_blank rel=noopener>services-networking</a></p><ul><li>userspace<ul><li>kube-proxyä¼šç›‘è§†Kubernetesæ§åˆ¶å¹³é¢å¯¹Serviceå¯¹è±¡å’ŒEndpointså¯¹è±¡çš„æ·»åŠ å’Œç§»é™¤æ“ä½œ</li><li>å¯¹æ¯ä¸ªServiceå®ƒä¼šåœ¨æœ¬åœ°Nodeä¸Šæ‰“å¼€ä¸€ä¸ªç«¯å£(éšæœºé€‰æ‹©) ä»»ä½•è¿æ¥åˆ°<strong>ä»£ç†ç«¯å£</strong>çš„è¯·æ±‚ éƒ½ä¼šè¢«ä»£ç†åˆ°Serviceçš„åç«¯<code>Pods</code>ä¸­çš„æŸä¸ªä¸Šé¢<ul><li>ä½¿ç”¨å“ªä¸ªåç«¯Podæ˜¯ kube-proxy åŸºäº<code>SessionAffinity</code>æ¥ç¡®å®šçš„</li></ul></li><li>æœ€å å®ƒé…ç½® iptables è§„åˆ™ æ•è·åˆ°è¾¾è¯¥ Service çš„<code>clusterIP</code>(æ˜¯è™šæ‹Ÿ IP)å’Œ<code>Port</code>çš„è¯·æ±‚ å¹¶é‡å®šå‘åˆ°ä»£ç†ç«¯å£ ä»£ç†ç«¯å£å†ä»£ç†è¯·æ±‚åˆ°åç«¯Pod<ul><li>é»˜è®¤æƒ…å†µä¸‹ ç”¨æˆ·ç©ºé—´æ¨¡å¼ä¸‹çš„kube-proxyé€šè¿‡è½®è½¬ç®—æ³•é€‰æ‹©åç«¯</li></ul></li><li>æµé‡æ¥å›åœ¨å†…æ ¸å’Œç”¨æˆ·ç©ºé—´åˆ‡æ¢ æ•ˆç‡è¾ƒä½</li></ul></li></ul><p><img src=/p/kubernetes/icons/services-userspace-overview.svg loading=lazy alt=services-userspace-overview></p><ul><li>iptables<ul><li><p><code>kube-proxy</code>ä¼šç›‘è§†Kubernetesæ§åˆ¶èŠ‚ç‚¹å¯¹Serviceå¯¹è±¡å’ŒEndpointså¯¹è±¡çš„æ·»åŠ å’Œç§»é™¤</p></li><li><p>å¯¹æ¯ä¸ªService å®ƒä¼šé…ç½®iptablesè§„åˆ™ ä»è€Œæ•è·åˆ°è¾¾è¯¥Serviceçš„<code>clusterIP</code>å’Œç«¯å£çš„è¯·æ±‚ è¿›è€Œå°†è¯·æ±‚é‡å®šå‘åˆ° Service çš„ä¸€ç»„åç«¯ä¸­çš„æŸä¸ªPodä¸Šé¢</p></li><li><p>å¯¹äºæ¯ä¸ªEndpointså¯¹è±¡ å®ƒä¹Ÿä¼šé…ç½®iptablesè§„åˆ™ è¿™ä¸ªè§„åˆ™ä¼šé€‰æ‹©ä¸€ä¸ªåç«¯ç»„åˆ</p><ul><li>é»˜è®¤çš„ç­–ç•¥æ˜¯ kube-proxyåœ¨iptablesæ¨¡å¼ä¸‹éšæœºé€‰æ‹©ä¸€ä¸ªåç«¯</li></ul></li><li><p>ä½¿ç”¨iptableså¤„ç†æµé‡å…·æœ‰è¾ƒä½çš„ç³»ç»Ÿå¼€é”€ å› ä¸ºæµé‡ç”±Linux netfilterå¤„ç† è€Œæ— éœ€åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´åˆ‡æ¢ è¿™ç§æ–¹æ³•ä¹Ÿå¯èƒ½æ›´å¯é </p></li><li><p>å¦‚æœkube-proxyåœ¨iptablesæ¨¡å¼ä¸‹è¿è¡Œ å¹¶ä¸”æ‰€é€‰çš„ç¬¬ä¸€ä¸ª Pod æ²¡æœ‰å“åº” åˆ™è¿æ¥å¤±è´¥</p><ul><li>è¿™ä¸ç”¨æˆ·ç©ºé—´æ¨¡å¼ä¸åŒ: åœ¨è¿™ç§æƒ…å†µä¸‹ kube-proxyå°†æ£€æµ‹åˆ°ä¸ç¬¬ä¸€ä¸ªPodçš„è¿æ¥å·²å¤±è´¥ å¹¶ä¼šè‡ªåŠ¨ä½¿ç”¨å…¶ä»–åç«¯Pod é‡è¯•</li><li>å¯ä»¥ä½¿ç”¨Pod<a class=link href=https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/pod-lifecycle/#container-probes target=_blank rel=noopener>å°±ç»ªæ¢æµ‹å™¨</a> éªŒè¯åç«¯Podå¯ä»¥æ­£å¸¸å·¥ä½œ ä»¥ä¾¿iptablesæ¨¡å¼ä¸‹çš„kube-proxyä»…çœ‹åˆ°æµ‹è¯•æ­£å¸¸çš„åç«¯ é¿å…å°†æµé‡é€šè¿‡kube-proxyå‘é€åˆ°å·²çŸ¥å·²å¤±è´¥çš„ Pod</li></ul></li></ul></li></ul><p><img src=/p/kubernetes/icons/services-iptables-overview.svg loading=lazy alt=services-iptables-overview></p><ul><li>ipvs<ul><li><p>ç‰¹æ€§çŠ¶æ€ï¼š Kubernetes v1.11 [stable]</p></li><li><p>åœ¨<code>ipvs</code>æ¨¡å¼ä¸‹ kube-proxyç›‘è§†KubernetesæœåŠ¡å’Œç«¯ç‚¹ è°ƒç”¨<code>netlink</code>æ¥å£åˆ›å»ºç›¸åº”çš„IPVSè§„åˆ™ å¹¶å®šæœŸå°†IPVSè§„åˆ™ä¸KubernetesæœåŠ¡å’Œç«¯ç‚¹åŒæ­¥ è¯¥æ§åˆ¶å¾ªç¯å¯ç¡®ä¿ IPVS çŠ¶æ€ä¸æ‰€éœ€çŠ¶æ€åŒ¹é…</p></li><li><p>è®¿é—®æœåŠ¡æ—¶ IPVSå°†æµé‡å®šå‘åˆ°åç«¯Podä¹‹ä¸€</p></li><li><p>IPVSä»£ç†æ¨¡å¼åŸºäºç±»ä¼¼äºiptablesæ¨¡å¼çš„netfilteræŒ‚é’©å‡½æ•° ä½†æ˜¯ä½¿ç”¨å“ˆå¸Œè¡¨ä½œä¸ºåŸºç¡€æ•°æ®ç»“æ„ å¹¶ä¸”åœ¨å†…æ ¸ç©ºé—´ä¸­å·¥ä½œ</p><ul><li>è¿™æ„å‘³ç€ ä¸iptablesæ¨¡å¼ä¸‹çš„kube-proxyç›¸æ¯” IPVSæ¨¡å¼ä¸‹çš„kube-proxyé‡å®šå‘é€šä¿¡çš„å»¶è¿Ÿè¦çŸ­ å¹¶ä¸”åœ¨åŒæ­¥ä»£ç†è§„åˆ™æ—¶å…·æœ‰æ›´å¥½çš„æ€§èƒ½</li><li>ä¸å…¶ä»–ä»£ç†æ¨¡å¼ç›¸æ¯” IPVSæ¨¡å¼è¿˜æ”¯æŒæ›´é«˜çš„ç½‘ç»œæµé‡ååé‡</li></ul></li><li><p>IPVSæä¾›äº†æ›´å¤šé€‰é¡¹æ¥å¹³è¡¡åç«¯Podçš„æµé‡</p><ul><li><code>rr</code>: è½®è¯¢(Round-Robin)</li><li><code>lc</code>: æœ€å°‘é“¾æ¥(Least Connection) å³æ‰“å¼€é“¾æ¥æ•°é‡æœ€å°‘è€…ä¼˜å…ˆ</li><li><code>dh</code>: ç›®æ ‡åœ°å€å“ˆå¸Œ(Destination Hashing)</li><li><code>sh</code>: æºåœ°å€å“ˆå¸Œ(Source Hashing)</li><li><code>sed</code>: æœ€çŸ­é¢„æœŸå»¶è¿Ÿ(Shortest Expected Delay)</li><li><code>nq</code>: ä»ä¸æ’é˜Ÿ(Never Queue)</li></ul></li><li><p>å¤‡æ³¨</p><ul><li>è¦åœ¨IPVSæ¨¡å¼ä¸‹è¿è¡Œkube-proxyå¿…é¡»åœ¨å¯åŠ¨kube-proxyä¹‹å‰ä½¿IPVSåœ¨èŠ‚ç‚¹ä¸Šå¯ç”¨</li><li>å½“kube-proxyä»¥IPVSä»£ç†æ¨¡å¼å¯åŠ¨æ—¶ å®ƒå°†éªŒè¯IPVSå†…æ ¸æ¨¡å—æ˜¯å¦å¯ç”¨<ul><li>å¦‚æœæœªæ£€æµ‹åˆ°IPVSå†…æ ¸æ¨¡å— åˆ™kube-proxyå°†é€€å›åˆ°ä»¥iptablesä»£ç†æ¨¡å¼è¿è¡Œ</li></ul></li></ul></li></ul></li></ul><p><img src=/p/kubernetes/icons/services-ipvs-overview.svg loading=lazy alt=services-ipvs-overview></p><h4 id=serviceç±»å‹>Serviceç±»å‹</h4><ul><li>ClusterIP: é€šè¿‡é›†ç¾¤çš„å†…éƒ¨IPæš´éœ²æœåŠ¡ é€‰æ‹©è¯¥å€¼æ—¶æœåŠ¡åªèƒ½å¤Ÿåœ¨é›†ç¾¤å†…éƒ¨è®¿é—® è¿™ä¹Ÿæ˜¯é»˜è®¤çš„<code>ServiceType</code></li><li><a class=link href=https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/#type-nodeport target=_blank rel=noopener>NodePort</a>: é€šè¿‡æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„IPå’Œé™æ€ç«¯å£(NodePort)æš´éœ²æœåŠ¡ NodePortæœåŠ¡ä¼šè·¯ç”±åˆ°è‡ªåŠ¨åˆ›å»ºçš„ClusterIPæœåŠ¡<ul><li>é€šè¿‡è¯·æ±‚ <code>&lt;èŠ‚ç‚¹IP>:&lt;èŠ‚ç‚¹ç«¯å£></code> ä½ å¯ä»¥ä»é›†ç¾¤çš„å¤–éƒ¨è®¿é—®ä¸€ä¸ªNodePortæœåŠ¡</li><li>Client -> NodeIP:NodePort -> ClusterIP:ServicePort -> PodIP:containerPort</li><li>ä¸ºé¿å…å•Nodeå‹åŠ›è¿‡å¤§ ä¼šåœ¨å¤–é¢å†åŠ ä¸€å±‚è´Ÿè½½å‡è¡¡<ul><li>å…¬æœ‰äº‘ç¯å¢ƒ: LBaaS(å‚è€ƒä¸‹é¢LoadBalancerç±»å‹)</li></ul></li></ul></li><li><a class=link href=https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/#loadbalancer target=_blank rel=noopener>LoadBalancer</a>: ä½¿ç”¨äº‘æä¾›å•†çš„è´Ÿè½½å‡è¡¡å™¨å‘å¤–éƒ¨æš´éœ²æœåŠ¡ å¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨å¯ä»¥å°†æµé‡è·¯ç”±åˆ°è‡ªåŠ¨åˆ›å»ºçš„NodePortæœåŠ¡å’ŒClusterIPæœåŠ¡ä¸Š</li><li><a class=link href=https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/#externalname target=_blank rel=noopener>ExternalName</a>: é€šè¿‡è¿”å›CNAMEå’Œå¯¹åº”å€¼ å¯ä»¥å°†æœåŠ¡æ˜ å°„åˆ°externalNameå­—æ®µçš„å†…å®¹(ä¾‹å¦‚<code>foo.bar.example.com</code>) æ— éœ€åˆ›å»ºä»»ä½•ç±»å‹ä»£ç†<ul><li>FQDN(CoreDNS å†…éƒ¨è§£æ)<ul><li>CNAME -> FQDN(å¤–éƒ¨çœŸæ­£çš„FQDN )</li></ul></li></ul></li></ul><h4 id=headless-servicesæ— å¤´service>Headless Services(æ— å¤´Service)</h4><ul><li>æœ‰æ—¶ä¸éœ€è¦æˆ–ä¸æƒ³è¦è´Ÿè½½å‡è¡¡ ä»¥åŠå•ç‹¬çš„Service IP é‡åˆ°è¿™ç§æƒ…å†µ å¯ä»¥é€šè¿‡æŒ‡å®šCluster IP(<code>spec.clusterIP</code>)çš„å€¼ä¸º <code>"None"</code>æ¥åˆ›å»º <code>Headless</code> Service</li><li>ä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ— å¤´Serviceä¸å…¶ä»–æœåŠ¡å‘ç°æœºåˆ¶è¿›è¡Œæ¥å£ è€Œä¸å¿…ä¸Kubernetesçš„å®ç°æ†ç»‘åœ¨ä¸€èµ·</li><li>å¯¹äºæ— å¤´<code>Services</code>å¹¶ä¸ä¼šåˆ†é…Cluster IP kube-proxyä¸ä¼šå¤„ç†å®ƒä»¬ è€Œä¸”å¹³å°ä¹Ÿä¸ä¼šä¸ºå®ƒä»¬è¿›è¡Œè´Ÿè½½å‡è¡¡å’Œè·¯ç”± DNSå¦‚ä½•å®ç°è‡ªåŠ¨é…ç½® ä¾èµ–äºServiceæ˜¯å¦å®šä¹‰äº†é€‰æ‹©ç®—ç¬¦</li></ul><h3 id=ingress>Ingress</h3><p><img src=/p/kubernetes/icons/ingress-flow.png width=1182 height=886 srcset="/p/kubernetes/icons/ingress-flow_hu9c99a0266fa357bab5ac86316de97a76_1018969_480x0_resize_box_3.png 480w, /p/kubernetes/icons/ingress-flow_hu9c99a0266fa357bab5ac86316de97a76_1018969_1024x0_resize_box_3.png 1024w" loading=lazy alt=ingress-flow class=gallery-image data-flex-grow=133 data-flex-basis=320px></p><p><a class=link href=https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress/ target=_blank rel=noopener>ingress</a></p><ul><li>Serviceå¯¹åç«¯ç‰¹å®šç±»å‹Podåˆ†ç±»(label selector)</li><li>IngressåŸºäºä¸Šé¢çš„åˆ†ç±»è¯†åˆ«åç«¯Pod å¹¶ç”Ÿæˆé…ç½®ä¿¡æ¯æ³¨å…¥åˆ°nginx(éœ€è¦é‡è½½é…ç½®)/envoy/traefikç­‰</li></ul><p><a class=link href=https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress-controllers/ target=_blank rel=noopener>ingress-controllers</a></p><h3 id=å­˜å‚¨å·>å­˜å‚¨å·</h3><p><a class=link href=https://kubernetes.io/zh-cn/docs/concepts/storage/ target=_blank rel=noopener>kubernetes-storage</a></p><p><code>kubectl explain pods.spec.volumes</code></p><ul><li>emptyDir # ä¸´æ—¶ç›®å½• éšpodåˆ é™¤è€Œæ¶ˆå¤±(ç”Ÿå‘½å‘¨æœŸåŒpod)<ul><li>gitRepo(cloneåˆ°æœºå™¨ ä¿®æ”¹ä¸ä¼šåŒæ­¥ éœ€è¦åŒæ­¥å¯ä»¥è‡ªå·±å†åšä¸€ä¸ªsidecar)</li></ul></li><li>hostPath # å®¿ä¸»æœºè·¯å¾„</li><li>SAN(iSCSI&mldr;)ã€NAS(nfsã€cifs&mldr;)</li><li>åˆ†å¸ƒå¼å­˜å‚¨<ul><li>glusterfsã€rdbã€cephfs</li></ul></li><li>äº‘å­˜å‚¨<ul><li>EBSã€Azure Disk&mldr;</li></ul></li></ul><h4 id=pvpvc>PV/PVC</h4><p><img src=/p/kubernetes/icons/pvc.png width=2068 height=1350 srcset="/p/kubernetes/icons/pvc_hufc33b2495877c5db5264e9558db08b3f_2577789_480x0_resize_box_3.png 480w, /p/kubernetes/icons/pvc_hufc33b2495877c5db5264e9558db08b3f_2577789_1024x0_resize_box_3.png 1024w" loading=lazy alt=pvc class=gallery-image data-flex-grow=153 data-flex-basis=367px></p><h4 id=storageclass>StorageClass</h4><ul><li>å­˜å‚¨è®¾å¤‡éœ€æ”¯æŒRESTfulé£æ ¼çš„åˆ›å»ºè¯·æ±‚</li><li>æ ¹æ®è¯·æ±‚åŠ¨æ€åˆ›å»ºPV</li></ul><h4 id=configmap>ConfigMap</h4><ul><li>ConfigMapæ˜¯ä¸€ç§ API å¯¹è±¡ ç”¨æ¥å°†éæœºå¯†æ€§çš„æ•°æ®ä¿å­˜åˆ°é”®å€¼å¯¹ä¸­</li><li>ä½¿ç”¨æ—¶<a class=link href=https://kubernetes.io/docs/concepts/workloads/pods/pod-overview/ target=_blank rel=noopener>Pods</a>å¯ä»¥å°†å…¶ç”¨ä½œç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œå‚æ•°æˆ–è€…å­˜å‚¨å·ä¸­çš„é…ç½®æ–‡ä»¶</li><li>ConfigMapå°†ä½ çš„ç¯å¢ƒé…ç½®ä¿¡æ¯å’Œ<a class=link href="https://kubernetes.io/zh-cn/docs/reference/glossary/?all=true#term-image" target=_blank rel=noopener>å®¹å™¨é•œåƒ</a>è§£è€¦ ä¾¿äºåº”ç”¨é…ç½®çš„ä¿®æ”¹</li></ul><h5 id=å®¹å™¨åŒ–é…ç½®åº”ç”¨æ–¹å¼>å®¹å™¨åŒ–é…ç½®åº”ç”¨æ–¹å¼</h5><ul><li>è‡ªå®šä¹‰å‘½ä»¤è¡Œå‚æ•°<ul><li>args: []</li></ul></li><li>æŠŠé…ç½®æ–‡ä»¶ç›´æ¥æ‰“åŒ…è‡³é•œåƒ</li><li>ç¯å¢ƒå˜é‡<ul><li>CloudNativeçš„åº”ç”¨ç¨‹åºä¸€èˆ¬å¯ç›´æ¥é€šè¿‡ç¯å¢ƒå˜é‡åŠ è½½é…ç½®</li><li>é€šè¿‡entrypointè„šæœ¬æ¥é¢„å¤„ç†å˜é‡ä¸ºé…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯</li></ul></li><li>å­˜å‚¨å·</li></ul><h4 id=secret>Secret</h4><ul><li>Secretæ˜¯ä¸€ç§åŒ…å«å°‘é‡æ•æ„Ÿä¿¡æ¯ä¾‹å¦‚å¯†ç ã€ä»¤ç‰Œæˆ–å¯†é’¥çš„å¯¹è±¡ è¿™æ ·çš„ä¿¡æ¯å¯èƒ½ä¼šè¢«æ”¾åœ¨<a class=link href=https://kubernetes.io/docs/concepts/workloads/pods/pod-overview/ target=_blank rel=noopener>Pod</a>è§„çº¦ä¸­æˆ–è€…é•œåƒä¸­</li><li>ä½¿ç”¨Secretæ„å‘³ç€ä½ ä¸éœ€è¦åœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­åŒ…å«æœºå¯†æ•°æ®</li><li>Secretç±»ä¼¼äº<a class=link href=https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/configure-pod-configmap/ target=_blank rel=noopener>ConfigMap</a>ä½†ä¸“é—¨ç”¨äºä¿å­˜æ•æ„Ÿæ•°æ®</li></ul><h2 id=statefulsetæ§åˆ¶å™¨>StatefulSetæ§åˆ¶å™¨</h2><ul><li><p>CoreOS Operator</p></li><li><p>cattle/pet # ä¸€ä¸ªå…³æ³¨ç¾¤ä½“ ä¸€ä¸ªå…³æ³¨ä¸ªä½“(å’Œæ— çŠ¶æ€åº”ç”¨çš„åŒºåˆ«)</p></li><li><p>PetSet(1.3) -> StatefulSet(1.5+)</p></li><li><p>StatefulSetä¸»è¦ç”¨äºç®¡ç†æœ‰ä»¥ä¸‹ç‰¹æ€§çš„åº”ç”¨ç¨‹åº</p><ul><li>ç¨³å®šä¸”å”¯ä¸€çš„ç½‘ç»œæ ‡è¯†ç¬¦</li><li>ç¨³å®šä¸”æŒä¹…çš„å­˜å‚¨</li><li>æœ‰åºã€å¹³æ»‘çš„éƒ¨ç½²å’Œæ‰©å±•</li><li>æœ‰åºã€å¹³æ»‘çš„ç»ˆæ­¢å’Œåˆ é™¤</li><li>æœ‰åºçš„æ»šåŠ¨æ›´æ–°</li></ul></li><li><p>ä¸€èˆ¬æ¥è¯´ ä¸€ä¸ªå…¸å‹çš„StatefulSetç”±ä¸‰ä¸ªç»„ä»¶ç»„æˆ</p><ul><li>handless service # æ— å¤´æœåŠ¡ ç¡®ä¿åç§°å”¯ä¸€</li><li>StatefulSet # æ§åˆ¶å™¨</li><li>volumeClaimTemplate # å­˜å‚¨å·ç”³è¯·æ¨¡ç‰ˆ(ä¸èƒ½ä½¿ç”¨åŒä¸€å­˜å‚¨å· podæ¨¡ç‰ˆåˆ›å»ºçš„å­˜å‚¨å·éƒ½æ˜¯ä¸€æ ·çš„ æ‰€ä»¥éœ€è¦å·ç”³è¯·æ¨¡ç‰ˆ)</li></ul></li><li><p><code>kubelet explain sts.spec.updateStrategy.rollingUpdate</code></p><ul><li>partition &lt;inter> # æ§åˆ¶æ›´æ–°çš„Pod</li><li>partition: N # å¤§äºç­‰äºç¼–å·Nçš„Podå°†è¢«æ›´æ–° é»˜è®¤å€¼: 0</li></ul></li></ul><h2 id=è®¤è¯åŠserviceaccount>è®¤è¯åŠServiceAccount</h2><h3 id=è®¤è¯æˆæƒ>è®¤è¯æˆæƒ</h3><ul><li>è®¤è¯(æ”¯æŒå¤šç§è®¤è¯æ–¹å¼) # è®¤è¯æ’ä»¶<ul><li>ä»¤ç‰Œè®¤è¯ bearer token</li><li>sslè®¤è¯(ç¡®è®¤æœåŠ¡ç«¯/å®¢æˆ·ç«¯èº«ä»½) åŒå‘è¯ä¹¦è®¤è¯(https)</li><li>&mldr;</li></ul></li><li>æˆæƒæ£€æŸ¥(æƒé™) # æˆæƒæ’ä»¶<ul><li>RBAC # kubeadméƒ¨ç½²çš„é›†ç¾¤å¼ºåˆ¶å¼€å¯RBAC</li><li>&mldr;</li></ul></li><li>å‡†å…¥æ§åˆ¶(å…³è”çš„å…¶ä»–èµ„æºæˆ–æ“ä½œ æ˜¯å¦æœ‰æƒé™ è¿›ä¸€æ­¥è¡¥å……æˆæƒæœºåˆ¶)</li><li>API Serveréœ€è¦ä¿¡æ¯å»è¯†åˆ«å®¢æˆ·ç«¯çš„æ“ä½œ<ul><li>user: username + uid</li><li>group</li><li>extra</li><li>API(è¯·æ±‚çš„Kubernetes API)<ul><li>Request Path<ul><li><code>kubectl proxy --port=8080</code></li><li><code>curl http://localhost:8080/api/v1/namespaces</code></li><li><code>curl http://localhost:8080/apis/apps/v1/namespaces/default/deployments/myapp-deploy/</code></li></ul></li><li>HTTP request verb<ul><li>GET POST PUT DELETE</li><li>get list create update patch watch proxy redirect delete deletecollection</li></ul></li><li>Resources</li><li>SubResources</li><li>Namespace</li><li>API Group</li></ul></li></ul></li></ul><h3 id=serviceaccount>ServiceAccount</h3><ul><li>è®¿é—®APIServerçš„ä¸¤ç§å®¢æˆ·ç«¯<ul><li>kubectl/dashborad é›†ç¾¤å¤–éƒ¨å®¢æˆ·ç«¯(userAccount)</li><li>pod é›†ç¾¤å†…éƒ¨å®¢æˆ·ç«¯(serviceAccount)<ul><li><code>kubectl explain pods.spec.serviceAccountName</code></li></ul></li></ul></li><li>kubeconfig<ul><li><code>kubectl config view</code></li></ul></li></ul><h3 id=rbacæˆæƒ>RBACæˆæƒ</h3><ul><li>æˆæƒæ’ä»¶<ul><li>Node</li><li>ABAC(<em>Attribute-based access control</em>)</li><li>RBAC(<em>Role-based access contro</em>)</li><li>Webhook</li></ul></li></ul><p><img src=/p/kubernetes/icons/k8s-RBAC.png width=1364 height=768 srcset="/p/kubernetes/icons/k8s-RBAC_hu93382d84de46ca6bdd4d6c35df8f4890_1483186_480x0_resize_box_3.png 480w, /p/kubernetes/icons/k8s-RBAC_hu93382d84de46ca6bdd4d6c35df8f4890_1483186_1024x0_resize_box_3.png 1024w" loading=lazy alt=k8s-RBAC class=gallery-image data-flex-grow=177 data-flex-basis=426px></p><ul><li>K8S-RBAC<ul><li>role<ul><li>operations</li><li>objects</li></ul></li><li>rolebinding<ul><li>user account OR service account</li><li>role</li></ul></li><li><code>kubectl create role pods-reader --verb=get,list,watch --resource=pods --dry-run -o yaml</code></li></ul></li></ul><p><img src=/p/kubernetes/icons/role-binding.png width=1498 height=1096 srcset="/p/kubernetes/icons/role-binding_hue49744d6898b8c4106d004f8692e3f91_1070895_480x0_resize_box_3.png 480w, /p/kubernetes/icons/role-binding_hue49744d6898b8c4106d004f8692e3f91_1070895_1024x0_resize_box_3.png 1024w" loading=lazy alt=role-binding class=gallery-image data-flex-grow=136 data-flex-basis=328px></p><h2 id=helm>Helm</h2><ul><li>ç±»ä¼¼yum</li></ul><h2 id=reference>Reference</h2><ul><li>ubuntu</li></ul><p><a class=link href="https://askubuntu.com/questions/428772/how-to-install-specific-version-of-some-package/428778#428778?newreg=d056242a7a0340598dd1d2d4fad63e81" target=_blank rel=noopener>apt install speciffic version</a></p><p><a class=link href=https://www.serverlab.ca/tutorials/containers/docker/how-to-set-the-proxy-for-docker-on-ubuntu/ target=_blank rel=noopener>set-proxy-on-ubuntu-docker</a></p><p><a class=link href=https://askubuntu.com/questions/2493/apt-get-or-aptitude-equivalent-to-yum-whatprovides target=_blank rel=noopener>apt-get-like-yum-whatprovides</a></p><ul><li>kubetnetes</li></ul><p><a class=link href=https://stackoverflow.com/questions/63136175/kubectl-get-componentstatus-shows-unhealthy target=_blank rel=noopener>kubectl-get-commponentstatus-shows-unhealthy</a></p></section><footer class=article-footer><section class=article-tags><a href=/tags/cloud-native/>Cloud Native</a>
<a href=/tags/kubernetes/>Kubernetes</a>
<a href=/tags/pod/>Pod</a>
<a href=/tags/service/>Service</a>
<a href=/tags/kubeadm/>Kubeadm</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>ç›¸å…³æ–‡ç« </h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/prometheus/><div class=article-details><h2 class=article-title>Prometheus</h2></div></a></article><article><a href=/p/docker/><div class=article-details><h2 class=article-title>Docker</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=ilolicon/ilolicon.github.io issue-term=pathname crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>let utterancesLoaded=!1;function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;utterancesLoaded=!0,setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{if(!utterancesLoaded)return;setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2017 -
2024 ilolicon's Blog</section><section class=powerby>VicissitudeğŸ³<br>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.21.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>